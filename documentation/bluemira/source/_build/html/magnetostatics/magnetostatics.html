

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>magnetostatics &mdash; bluemira 0+untagged.57.g61b7f79.dirty documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="utilities" href="../utilities.html" />
    <link rel="prev" title="geometry" href="../geometry.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> bluemira
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html">Bluemira Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../base.html">base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.html">geometry</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">magnetostatics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#d-current-sources">2-D current sources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#green-s-functions">Green’s functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#semi-analytical-functions">Semi-analytical functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id2">3-D current sources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#biot-savart">Biot-Savart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#semi-analytical">Semi-analytical</a></li>
<li class="toctree-l4"><a class="reference internal" href="#finite-element">Finite element</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../utilities.html">utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">Module Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">bluemira</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../modules.html">Bluemira Modules</a> &raquo;</li>
        
      <li>magnetostatics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/magnetostatics/magnetostatics.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="magnetostatics">
<h1>magnetostatics<a class="headerlink" href="#magnetostatics" title="Permalink to this headline">¶</a></h1>
<p>A collection of analytical and semi-analytical calculation tools to evaluate magnetic
field from arbitrary coils.</p>
<div class="section" id="d-current-sources">
<h2>2-D current sources<a class="headerlink" href="#d-current-sources" title="Permalink to this headline">¶</a></h2>
<p>The following relations are for circular current sources about the <span class="math notranslate nohighlight">\(z\)</span>-axis.</p>
<div class="section" id="green-s-functions">
<h3>Green’s functions<a class="headerlink" href="#green-s-functions" title="Permalink to this headline">¶</a></h3>
<p>The Green’s functions for poloidal magnetic flux, radial magnetic field,
and vertical magnetic field at a point <span class="math notranslate nohighlight">\((x, z)\)</span> due to a unit
current source at point <span class="math notranslate nohighlight">\((x_c, z_c)\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">bluemira.magnetostatics.greens</span> <span class="kn">import</span> <span class="n">greens_psi</span><span class="p">,</span> <span class="n">greens_Bx</span><span class="p">,</span> <span class="n">greens_Bz</span>

<span class="n">coil_x</span><span class="p">,</span> <span class="n">coil_z</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="n">psi</span> <span class="o">=</span> <span class="n">greens_psi</span><span class="p">(</span><span class="n">coil_x</span><span class="p">,</span> <span class="n">coil_z</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">zz</span><span class="p">)</span>
<span class="n">Bx</span> <span class="o">=</span> <span class="n">greens_Bx</span><span class="p">(</span><span class="n">coil_x</span><span class="p">,</span> <span class="n">coil_z</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">zz</span><span class="p">)</span>
<span class="n">Bz</span> <span class="o">=</span> <span class="n">greens_Bz</span><span class="p">(</span><span class="n">coil_x</span><span class="p">,</span> <span class="n">coil_z</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">zz</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" id="fig-greens">
<img alt="../_images/pic_greens.png" src="../_images/pic_greens.png" />
</div>
<p>To obtain the actual <span class="math notranslate nohighlight">\(\psi\)</span>, <span class="math notranslate nohighlight">\(B_x\)</span>, and <span class="math notranslate nohighlight">\(B_z\)</span> in V.s / rad and T,
simply multiply the Green’s functions by the current at the source point in Ampères.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above Green’s functions are effectively for an infinitely thin filament and
diverge logarithmically as the evaluation point approaches the source point.</p>
</div>
</div>
<div class="section" id="semi-analytical-functions">
<h3>Semi-analytical functions<a class="headerlink" href="#semi-analytical-functions" title="Permalink to this headline">¶</a></h3>
<p>For a circular coil of rectangular cross-section, a semi-analytic reduction of the 3-D
Biot-Savart law is used, as developed by <a class="reference internal" href="#zhang-2012" id="id1"><span>[Zhang_2012]</span></a>. Numerical integration is used in
one dimension, and some singularities in the equations are resolved numerically and
analytically.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">bluemira.magnetostatics.semianalytic_2d</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">semianalytic_psi</span><span class="p">,</span>
    <span class="n">semianalytic_Bx</span><span class="p">,</span>
    <span class="n">semianalytic_Bz</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">coil_x</span><span class="p">,</span> <span class="n">coil_z</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span>
<span class="n">coil_dx</span><span class="p">,</span> <span class="n">coil_dz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="n">psi</span> <span class="o">=</span> <span class="n">semianalytic_psi</span><span class="p">(</span><span class="n">coil_x</span><span class="p">,</span> <span class="n">coil_z</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">coil_dx</span><span class="p">,</span> <span class="n">coil_dz</span><span class="p">)</span>
<span class="n">Bx</span> <span class="o">=</span> <span class="n">semianalytic_Bx</span><span class="p">(</span><span class="n">coil_x</span><span class="p">,</span> <span class="n">coil_z</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">coil_dx</span><span class="p">,</span> <span class="n">coil_dz</span><span class="p">)</span>
<span class="n">Bz</span> <span class="o">=</span> <span class="n">semianalytic_Bz</span><span class="p">(</span><span class="n">coil_x</span><span class="p">,</span> <span class="n">coil_z</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">coil_dx</span><span class="p">,</span> <span class="n">coil_dz</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" id="fig-semianalytic">
<img alt="../_images/pic_semianalytic.png" src="../_images/pic_semianalytic.png" />
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The above semi-analytical functions are best used for points inside or near the
current source. If you favour speed over accuracy, for points further away from the
current source, you are better off using some quadratures of Green’s functions.</p>
</div>
</div>
</div>
<div class="section" id="id2">
<h2>3-D current sources<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Several options are available for calculating magnetic fields due to three-dimensional
current sources.</p>
<div class="section" id="biot-savart">
<h3>Biot-Savart<a class="headerlink" href="#biot-savart" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Biot%E2%80%93Savart_law">Biot-Savart equation</a>
can be solved assuming the current sources are thin wires, as is done in the
<code class="docutils literal notranslate"><span class="pre">BiotSavartFilament</span></code> object.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">radius</span></code> argument can be specified, which makes use of a square decay law for values
inside the filament <code class="docutils literal notranslate"><span class="pre">radius</span></code>. The field from a filament thus reaches a maximum at the
surface of the filament.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">bluemira.magnetostatics.biot_savart</span> <span class="kn">import</span> <span class="n">BiotSavartFilament</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">BiotSavartFilament</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="n">zz</span><span class="p">)</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Bx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">By</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Bz</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">source</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;magma&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" id="fig-biotsavart">
<img alt="../_images/pic_biotsavart.png" src="../_images/pic_biotsavart.png" />
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The discretisation of geometry input should be carefully checked. In general, many
points will give better approximations to long, thin wires.</p>
</div>
</div>
<div class="section" id="semi-analytical">
<h3>Semi-analytical<a class="headerlink" href="#semi-analytical" title="Permalink to this headline">¶</a></h3>
<p>If the infinitely thin approximation is not appropriate for your use case, consider
using one of the <code class="docutils literal notranslate"><span class="pre">RectangularCrossSectionCurrentSource</span></code> objects.</p>
<div class="section" id="trapezoidal-prisms">
<h4>Trapezoidal prisms<a class="headerlink" href="#trapezoidal-prisms" title="Permalink to this headline">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">TrapezoidalPrismCurrentSource</span></code> object is used for straight bars of uniform
current density, with taperings at either end. The magnetic field can be calculated at
any point, following equations described in <a class="reference internal" href="#babic-2005a" id="id3"><span>[Babic_2005a]</span></a> and <a class="reference internal" href="#babic-2005b" id="id4"><span>[Babic_2005b]</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">bluemira.magnetostatics.trapezoidal_prism</span> <span class="kn">import</span> <span class="n">TrapezoidalPrismCurrentSource</span>


<span class="n">source</span> <span class="o">=</span> <span class="n">TrapezoidalPrismCurrentSource</span><span class="p">(</span>
    <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># the centroid of the current source</span>
    <span class="n">ds</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>  <span class="c1"># length of the source is determined by the norm of ds</span>
    <span class="n">normal</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">t_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">breadth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># in t_vec direction</span>
    <span class="n">depth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>  <span class="c1"># in normal direction</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>  <span class="c1"># angle at the tip of the current source</span>
    <span class="n">beta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span>  <span class="c1"># angle at the tail of the current source</span>
    <span class="n">current</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Calculate field values in global x, y, z Cartesian coordinates.</span>
<span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xx</span><span class="p">))</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Bx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">By</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Bz</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">source</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" id="fig-trapezoidal">
<img alt="../_images/pic_trapezoidal.png" src="../_images/pic_trapezoidal.png" />
</div>
<p>The tapering at either end of the current source is to facilitate treatment of
curvilinear circuits. As the tapering is only in one plane however, this treatment
is only directly applicable to planar curvilinear circuits.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ArbitraryPlanarRectangularXSCircuit</span></code> is a utility provided to enable the user to
easily set up a planar circuit with a rectangular cross-section using
<code class="docutils literal notranslate"><span class="pre">TrapezoidalPrismCurrentSource</span></code> objects.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">bluemira.magnetostatics.circuits</span> <span class="kn">import</span> <span class="n">ArbitraryPlanarRectangularXSCircuit</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">ArbitraryPlanarRectangularXSCircuit</span><span class="p">(</span>
    <span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="n">breadth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">current</span><span class="o">=</span><span class="mf">1e6</span>
<span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="n">zz</span><span class="p">)</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Bx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">By</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Bz</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">source</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;magma&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$B$ [T]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$x$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$z$&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" id="fig-planar">
<img alt="../_images/pic_planar.png" src="../_images/pic_planar.png" />
</div>
</div>
<div class="section" id="circular-arcs">
<h4>Circular arcs<a class="headerlink" href="#circular-arcs" title="Permalink to this headline">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">CircularArcCurrentSource</span></code> object is used for circular arcs of uniform current
density. The magnetic field can be calculated at any point, following equations
described in <a class="reference internal" href="#feng-1985" id="id5"><span>[Feng_1985]</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">bluemira.magnetostatics.circular_arc</span> <span class="kn">import</span> <span class="n">CircularArcCurrentSource</span>


<span class="n">source</span> <span class="o">=</span> <span class="n">CircularArcCurrentSource</span><span class="p">(</span>
    <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">ds</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">normal</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">t_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">breadth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">dtheta</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">current</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


<span class="c1"># Calculate field values in global x, y, z Cartesian coordinates.</span>
<span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xx</span><span class="p">))</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Bx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">By</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Bz</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">source</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" id="fig-circular">
<img alt="../_images/pic_circular.png" src="../_images/pic_circular.png" />
</div>
</div>
</div>
<div class="section" id="finite-element">
<h3>Finite element<a class="headerlink" href="#finite-element" title="Permalink to this headline">¶</a></h3>
<p>TBD.</p>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="zhang-2012"><span class="brackets"><a class="fn-backref" href="#id1">Zhang_2012</a></span></dt>
<dd><ol class="upperalpha simple" start="4">
<li><p>Zhang, C. S. Koh, An Efficient Semianalytic Computation Method of Magnetic Field for a Circular Coil With Rectangular Cross Section, IEEE Transactions on Magnetics, 2012, pp. 62-68</p></li>
</ol>
</dd>
<dt class="label" id="babic-2005a"><span class="brackets"><a class="fn-backref" href="#id3">Babic_2005a</a></span></dt>
<dd><ol class="upperalpha simple" start="19">
<li><p>Babic and C. Aykel, An improvement in the calculation of the magnetic field for an arbitrary geometry coil with rectangular cross section, International Journal of Numerical Modelling, Electronic Networks, Devices and Fields, 2005, vol. 18, pp. 493-504</p></li>
</ol>
</dd>
<dt class="label" id="babic-2005b"><span class="brackets"><a class="fn-backref" href="#id4">Babic_2005b</a></span></dt>
<dd><ol class="upperalpha simple" start="19">
<li><p>Babic and C. Aykel, An improvement in the calculation of the magnetic field for an arbitrary geometry coil with rectangular cross section - Erratum, International Journal of Numerical Modelling, Electronic Networks, Devices and Fields, 2005</p></li>
</ol>
</dd>
<dt class="label" id="feng-1985"><span class="brackets"><a class="fn-backref" href="#id5">Feng_1985</a></span></dt>
<dd><ol class="upperalpha simple" start="26">
<li><ol class="upperalpha simple" start="24">
<li><p>Feng, The treatment of singularities in calculation of magnetic field using integral method, IEEE Transactions on Magnetics, 1985, vol. 21</p></li>
</ol>
</li>
</ol>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../utilities.html" class="btn btn-neutral float-right" title="utilities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../geometry.html" class="btn btn-neutral float-left" title="geometry" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, M. Coleman, J. Cook, F. Franza, I. Maione, S. McIntosh, J. Morris, D. Short.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>